#ifndef RECORDENCODER_H
#define RECORDENCODER_H

#include <deque>
#include <vector>

#include "base/Error.hpp"
#include "tsdbutil/EncBuf.hpp"
#include "tsdbutil/tsdbutils.hpp"

namespace tsdb {
namespace tsdbutil {

class RecordEncoder {
 public:
  // ┌────────────────────────────────────────────┐
  // │ type = 1 <1b>                              │
  // ├────────────────────────────────────────────┤
  // │ ┌─────────┬──────────────────────────────┐ │
  // │ │ id <8b> │ n = len(labels) <uvarint>    │ │
  // │ ├─────────┴────────────┬─────────────────┤ │
  // │ │ len(str_1) <uvarint> │ str_1 <bytes>   │ │
  // │ ├──────────────────────┴─────────────────┤ │
  // │ │  ...                                   │ │
  // │ ├───────────────────────┬────────────────┤ │
  // │ │ len(str_2n) <uvarint> │ str_2n <bytes> │ │
  // │ └───────────────────────┴────────────────┘ │
  // │                  . . .                     │
  // └────────────────────────────────────────────┘
  //
  // Series appends the encoded series to b and returns the resulting slice.
  static void series(const std::deque<RefSeries> &refseries,
                     std::vector<uint8_t> &rec);

  // ┌────────────────────────────────────────────────┐
  // │ type = 4 <1b>                                  │
  // ├────────────────────────────────────────────────┤
  // │ ┌────────────────────────────────────────────┐ │
  // │ │ ┌───────────────┬────────────────────────┐ │ │
  // │ │ │ group id <8b> │ num_series <uvarint>   │ │ │
  // │ │ └───────────────┴────────────────────────┘ │ │
  // │ │ ┌─────────┬──────────────────────────────┐ │ │
  // │ │ │ id <8b> │ n = len(labels) <uvarint>    │ │ │
  // │ │ ├─────────┴────────────┬─────────────────┤ │ │
  // │ │ │ len(str_1) <uvarint> │ str_1 <bytes>   │ │ │
  // │ │ ├──────────────────────┴─────────────────┤ │ │
  // │ │ │  ...                                   │ │ │
  // │ │ ├───────────────────────┬────────────────┤ │ │
  // │ │ │ len(str_2n) <uvarint> │ str_2n <bytes> │ │ │
  // │ │ └───────────────────────┴────────────────┘ │ │
  // │ │                  . . .                     │ │
  // │ └────────────────────────────────────────────┘ │
  // │                    . . .                       │
  // └────────────────────────────────────────────────┘
  // static void group_series(const std::deque<RefGroupSeries> &rgs,
  //                          std::vector<uint8_t> &rec);
  // static void group_series(const RefGroupSeries &rgs,
  //                          std::vector<uint8_t> &rec);

  // ┌──────────────────────────────────────────────────────────────────┐
  // │ type = 2 <1b>                                                    │
  // ├──────────────────────────────────────────────────────────────────┤
  // │ ┌────────────────────┬───────────────────────────┬─────────────┐ │
  // │ │ id <8b>            │ timestamp <8b>            │ value <8b>  │ │
  // │ └────────────────────┴───────────────────────────┴─────────────┘ │
  // │ ┌────────────────────┬───────────────────────────┬─────────────┐ │
  // │ │ id_delta <varint>  │ timestamp_delta <varint>  │ value <8b>  │ │
  // │ └────────────────────┴───────────────────────────┴─────────────┘ │
  // │                              . . .                               │
  // └──────────────────────────────────────────────────────────────────┘
  //
  // Samples appends the encoded samples to b and returns the resulting slice.
  static void samples(const std::deque<RefSample> &refsamples,
                      std::vector<uint8_t> &rec);

  // ┌──────────────────────────────────────────────────────────────────────┐
  // │ type = 5 <1b>                                                        │
  // ├──────────────────────────────────────────────────────────────────────┤
  // │ ┌──────────────────────────────────────────────────────────────────┐ │
  // │ │ ┌───────────────┬──────────────────────┬───────────────────────┐ │ │
  // │ │ │ group id <8b> │ num_series <uvarint> │ timestamp <8b>        │ │ │
  // │ │ └───────────────┴──────────────────────┴───────────────────────┘ │ │
  // │ │ ┌────────────────────┬─────────────────────────────────────────┐ │ │
  // │ │ │ id <8b>            │ value <8b>                              │ │ │
  // │ │ └────────────────────┴─────────────────────────────────────────┘ │ │
  // │ │ ┌────────────────────┬─────────────────────────────────────────┐ │ │
  // │ │ │ id_delta <uvarint> │ value <8b>                              │ │ │
  // │ │ └────────────────────┴─────────────────────────────────────────┘ │ │
  // │ │                              . . .                               │ │
  // │ └──────────────────────────────────────────────────────────────────┘ │
  // │                                . . .                                 │
  // └──────────────────────────────────────────────────────────────────────┘
  // static void group_samples(const std::deque<RefGroupSample> &rgs,
  //                           std::vector<uint8_t> &rec);
  // static void group_samples(const RefGroupSample &rgs,
  //                           std::vector<uint8_t> &rec);

  // ┌─────────────────────────────────────────────────────┐
  // │ type = 3 <1b>                                       │
  // ├─────────────────────────────────────────────────────┤
  // │ ┌─────────┬───────────────────┬───────────────────┐ │
  // │ │ id <8b> │ min_time <varint> │ max_time <varint> │ │
  // │ └─────────┴───────────────────┴───────────────────┘ │
  // │                        . . .                        │
  // └─────────────────────────────────────────────────────┘
  //
  // Tombstones appends the encoded tombstones to b and returns the resulting
  // slice.
  static void tombstones(const std::deque<Stone> &stones,
                         std::vector<uint8_t> &rec);
  // ┌─────────────────────────────────────────────────────┐
  // │ type = 6 <1b>                                       │
  // ├─────────────────────────────────────────────────────┤
  // │ ┌─────────┬───────────────────┬───────────────────┐ │
  // │ │ id <8b> │ min_time <varint> │ max_time <varint> │ │
  // │ └─────────┴───────────────────┴───────────────────┘ │
  // │                        . . .                        │
  // └─────────────────────────────────────────────────────┘
  // static void group_tombstones(const std::deque<Stone> &stones,
  //                              std::vector<uint8_t> &rec);
};

}  // namespace tsdbutil
}  // namespace tsdb

#endif
